{"meta":{"title":"Serendipity's blogs","subtitle":"","description":"","author":"Serendipity","url":"http://yoursite.com","root":"/"},"pages":[{"title":"about","date":"2020-08-04T02:16:53.000Z","updated":"2020-08-04T02:17:01.944Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":""},{"title":"contact","date":"2020-08-04T02:17:14.000Z","updated":"2020-08-04T02:17:26.130Z","comments":true,"path":"contact/index.html","permalink":"http://yoursite.com/contact/index.html","excerpt":"","text":""},{"title":"tags","date":"2020-08-04T02:16:29.000Z","updated":"2020-08-04T02:16:44.736Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""},{"title":"404","date":"2018-08-04T02:20:30.000Z","updated":"2020-08-04T02:21:03.246Z","comments":true,"path":"404.html","permalink":"http://yoursite.com/404.html","excerpt":"","text":""},{"title":"categories","date":"2020-08-04T02:15:52.000Z","updated":"2020-08-04T02:16:18.407Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"SpringCloudä¹‹æœåŠ¡ç½‘å…³ï¼ˆå°šç¡…è°·ï¼‰","slug":"SpringCloudä¹‹æœåŠ¡ç½‘å…³ï¼ˆå°šç¡…è°·ï¼‰","date":"2020-08-03T03:01:49.000Z","updated":"2020-08-04T01:36:37.989Z","comments":true,"path":"2020/08/03/SpringCloudä¹‹æœåŠ¡ç½‘å…³ï¼ˆå°šç¡…è°·ï¼‰/","link":"","permalink":"http://yoursite.com/2020/08/03/SpringCloud%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/","excerpt":"","text":"Gatewayæ–°ä¸€ä»£ç½‘å…³ä»€ä¹ˆæ˜¯Gatewayç½‘å…³ï¼Ÿ1.Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡,åŸºäºSpring 5,Spring Boot 2å’ŒProject Reactorç­‰æŠ€æœ¯ã€‚ 2.Gatewayæ—¨åœ¨æä¾›ä¸€ ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥å¸æä¾›- äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œ ä¾‹å¦‚:ç†”æ–­ã€é™æµã€é‡è¯•ç­‰ 3.SpringCloud Gatewayæ˜¯Spring Cloudçš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®,çº¡Spring 5.0+ Spring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³,å®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€ çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚ 4.SpringCloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Zuul,åœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Netty 5.SpringCloud Gatewayçš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸº äºFilter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚:å®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡, å’Œé™æµã€‚ SpringCloud Gatewayçš„ç‰¹æ€§1.åŸºäºSpring Framework 5, Project Reactorå’ŒSpring Boot 2.0è¿›è¡Œæ„å»º; 2.åŠ¨æ€è·¯ç”±:èƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§; 3.å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šPredicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ; 4.é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½; 5.é›†æˆSpring CloudæœåŠ¡å‘ç°åŠŸèƒ½; 6.æ˜“äºç¼–å†™çš„Predicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ; 7.è¯·æ±‚é™æµåŠŸèƒ½; 8.æ”¯æŒè·¯å¾„é‡å†™ã€‚ Gatewayä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ Routeè·¯ç”±ï¼šè·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±ã€‚ Predicateæ–­è¨€ï¼šå‚è€ƒçš„æ˜¯java8çš„java.util.function.Predicateã€‚å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±ã€‚ Filterè¿‡æ»¤ï¼šæŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚ webè¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚ predicateå°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œfilterï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„æ‹¦æˆªå™¨ã€‚è€Œæœ‰äº†è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå†åŠ ä¸Šç›®æ ‡uriï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±äº†ã€‚ Gatewayå·¥ä½œæµç¨‹ æ ¸å¿ƒé€»è¾‘ï¼šè·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾ å…¥é—¨é…ç½®1.æ–°å»ºmoduleï¼šcloud-gateway-gateway9527 2.æ”¹pomæ–‡ä»¶ &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"> &lt;parent> &lt;artifactId>cloud2020&lt;/artifactId> &lt;groupId>com.sunqs.springcloud&lt;/groupId> &lt;version>1.0-SNAPSHOT&lt;/version> &lt;/parent> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;artifactId>cloud-gateway-gateway9527&lt;/artifactId> &lt;dependencies> &lt;!--gateway--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-gateway&lt;/artifactId> &lt;/dependency> &lt;!--eureka client--> &lt;dependency> &lt;groupId>org.springframework.cloud&lt;/groupId> &lt;artifactId>spring-cloud-starter-netflix-eureka-client&lt;/artifactId> &lt;/dependency> &lt;!--å¼•å…¥è‡ªå®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä½¿ç”¨Paymentæ”¯ä»˜Entity--> &lt;dependency> &lt;groupId>com.aiguigu.springcloud&lt;/groupId> &lt;artifactId>cloud-api-commons&lt;/artifactId> &lt;version>1.0-SNAPSHOT&lt;/version> &lt;scope>compile&lt;/scope> &lt;/dependency> &lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-devtools&lt;/artifactId> &lt;scope>runtime&lt;/scope> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.projectlombok&lt;/groupId> &lt;artifactId>lombok&lt;/artifactId> &lt;optional>true&lt;/optional> &lt;/dependency> &lt;dependency> &lt;groupId>org.springframework.boot&lt;/groupId> &lt;artifactId>spring-boot-starter-test&lt;/artifactId> &lt;scope>test&lt;/scope> &lt;/dependency> &lt;/dependencies> &lt;/project> 3.å†™yml server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: routes: - id: payment_routh #payment_routh #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_routh #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: service-url: register-with-eureka: true fetch-registry: true defaultZone: http://eureka7001.com:7001/eureka 4.ä¸šåŠ¡ç±»ï¼šæ—  5.ä¸»å¯åŠ¨ç±»ï¼šGateWayMain9527 @SpringBootApplication @EnableEurekaClient public class GateWayMain9527 &amp;#123; public static void main(String[] args) &amp;#123; SpringApplication.run(GateWayMain9527.class,args); &amp;#125; &amp;#125; 6.æµ‹è¯•ï¼šhttp://localhost:8001/payment/get/31ä¸http://localhost:9527/payment/get/31 éƒ½å¯ä»¥è®¿é—®åˆ°ã€‚ 7:gatewayç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼ åœ¨é…ç½®æ–‡ä»¶ymlä¸­é…ç½®ï¼› ä»£ç ä¸­æ³¨å…¥RouteLocatorçš„Beanï¼š @Configuration public class GatewayConfig &amp;#123; @Bean public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder)&amp;#123; RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes(); routes.route(\"path_route_atguigu\", r -> r.path(\"/guonei\") .uri(\"http://news.baidu.com/guonei\")).build(); return routes.build(); &amp;#125; &amp;#125; å¦‚æœè¦è®¿é—® http://news.baidu.com/guonei è¿™ä¸ªç½‘ç«™,é…ç½®è·¯ç”±è§„åˆ™ä¸ºhttp://localhost:9527/guoneiå°±å¯ä»¥è®¿é—®åˆ° é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”± pomæ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹ server: port: 9527 spring: application: name: cloud-gateway cloud: gateway: discovery: locator: enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½,åˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”± routes: - id: payment_routh #payment_routh #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å uri: lb://cloud-payment-service # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/get/** #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± - id: payment_routh2 #payment_routh #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å uri: lb://cloud-payment-service # uri: http://localhost:8001 #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ predicates: - Path=/payment/lb/** #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”± eureka: instance: hostname: cloud-gateway-service client: fetch-registry: true register-with-eureka: true service-url: #è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ # defaultZone: http://eureka7002.com:7002/eureka/ # å•æœºç‰ˆeureka defaultZone: http://eureka7001.com:7001/eureka/ Predicateçš„ä½¿ç”¨å¸¸ç”¨çš„Route Predicate After Route Predicateï¼š- After=2020-08-04T08:54:04.768+08:00[Asia/Shanghai] Before Route Predicateï¼š- Before=2020-08-04T08:54:04.768+08:00[Asia/Shanghai] Between Route Predicateï¼š- Between=2020-08-04T08:54:04.768+08:00[Asia/Shanghai],2020-09-04T08:54:04.768+08:00[Asia/Shanghai] Cookie Route Predicateï¼š- Cookie=username,zzyy Header Route Predicateï¼š- Header=X-Request-Id,\\d+ Host Route Predicate Method Route Predicate Path Route Predicate Query Route Predicate æ—¶é—´æ–­è¨€æ ¼å¼çš„è·å–public static void main(String[] args) &amp;#123; ZonedDateTime zdt = ZonedDateTime.now(); System.out.println(zdt); &amp;#125; 2020-08-04T08:54:04.768+08:00[Asia/Shanghai] æ€»ç»“Predicateå°±æ˜¯ä¸ºäº†å®ç°ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œè®©è¯·æ±‚è¿‡æ¥æ‰¾åˆ°å¯¹åº”çš„Routeè¿›è¡Œå¤„ç†ã€‚ Filterçš„ä½¿ç”¨Gateway Filteræ˜¯ä»€ä¹ˆè·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚ Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿã€‚ ç”Ÿå‘½å‘¨æœŸï¼špreï¼Œpost ç§ç±»ï¼šGatewayFilter(31ç§),GlobalFilter(åç§) è‡ªå®šä¹‰è¿‡æ»¤å™¨1.åˆ›å»ºGatewayé…ç½®ç±» @Configuration @Slf4j @Order(0) public class MyLogGatewayFilter implements GlobalFilter, Ordered &amp;#123; @Override public Mono&lt;Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) &amp;#123; log.info(\"******come in MyLogGatewayFilter: \" + new Date()); String uname = exchange.getRequest().getQueryParams().getFirst(\"uname\"); if (uname == null) &amp;#123; log.info(\"******ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼ŒğŸ˜¿\"); exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE); return exchange.getResponse().setComplete(); &amp;#125; return chain.filter(exchange); &amp;#125; @Override public int getOrder() &amp;#123; return 0; &amp;#125; &amp;#125; // @Override å®ç°ä¸Šé¢@Order(0)æ³¨è§£å°±å¯ä»¥ä¸ç”¨å®ç°æ¥å£ // public int getOrder() &amp;#123; // return 0; // &amp;#125; å¯ä»¥å†™å¤šä¸ªFilterè¿›è¡Œè¿‡æ»¤ï¼Œä¼ å›è¿‡æ»¤é“¾å°±è¡Œã€‚","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2020-08-03T02:57:46.437Z","updated":"2020-08-03T02:57:46.437Z","comments":true,"path":"2020/08/03/hello-world/","link":"","permalink":"http://yoursite.com/2020/08/03/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post$ hexo new \"My New Post\" More info: Writing Run server$ hexo server More info: Server Generate static files$ hexo generate More info: Generating Deploy to remote sites$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[],"tags":[]}