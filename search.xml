<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SpringCloudä¹‹æœåŠ¡ç½‘å…³ï¼ˆå°šç¡…è°·ï¼‰</title>
      <link href="/2020/08/03/SpringCloud%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/"/>
      <url>/2020/08/03/SpringCloud%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3%EF%BC%88%E5%B0%9A%E7%A1%85%E8%B0%B7%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Gatewayæ–°ä¸€ä»£ç½‘å…³"><a href="#Gatewayæ–°ä¸€ä»£ç½‘å…³" class="headerlink" title="Gatewayæ–°ä¸€ä»£ç½‘å…³"></a>Gatewayæ–°ä¸€ä»£ç½‘å…³</h1><h2 id="ä»€ä¹ˆæ˜¯Gatewayç½‘å…³ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Gatewayç½‘å…³ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Gatewayç½‘å…³ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯Gatewayç½‘å…³ï¼Ÿ</h2><p>1.Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡,åŸºäºSpring 5,Spring Boot 2å’ŒProject Reactorç­‰æŠ€æœ¯ã€‚</p><p>2.Gatewayæ—¨åœ¨æä¾›ä¸€ ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥å¸æä¾›- äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œ ä¾‹å¦‚:ç†”æ–­ã€é™æµã€é‡è¯•ç­‰</p><p>3.SpringCloud Gatewayæ˜¯Spring Cloudçš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®,çº¡Spring 5.0+ Spring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³,å®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€ çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p><p>4.SpringCloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Zuul,åœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Netty</p><p>5.SpringCloud Gatewayçš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸº äºFilter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚:å®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡, å’Œé™æµã€‚</p><p><img src="https://gitee.com/serendipity24/SerendipityPic/raw/master/img/20200803160342.png"></p><h2 id="SpringCloud-Gatewayçš„ç‰¹æ€§"><a href="#SpringCloud-Gatewayçš„ç‰¹æ€§" class="headerlink" title="SpringCloud Gatewayçš„ç‰¹æ€§"></a>SpringCloud Gatewayçš„ç‰¹æ€§</h2><p>1.åŸºäºSpring Framework 5, Project Reactorå’ŒSpring Boot 2.0è¿›è¡Œæ„å»º;</p><p>2.åŠ¨æ€è·¯ç”±:èƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§;</p><p>3.å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šPredicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ;</p><p>4.é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½;</p><p>5.é›†æˆSpring CloudæœåŠ¡å‘ç°åŠŸèƒ½;</p><p>6.æ˜“äºç¼–å†™çš„Predicate (æ–­è¨€)å’ŒFilter (è¿‡æ»¤å™¨) ;</p><p>7.è¯·æ±‚é™æµåŠŸèƒ½;</p><p>8.æ”¯æŒè·¯å¾„é‡å†™ã€‚</p><h2 id="Gatewayä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"><a href="#Gatewayä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Gatewayä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ"></a>Gatewayä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ</h2><blockquote><p>Routeè·¯ç”±ï¼šè·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±ã€‚</p><p>Predicateæ–­è¨€ï¼šå‚è€ƒçš„æ˜¯java8çš„java.util.function.Predicateã€‚å¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±ã€‚</p><p>Filterè¿‡æ»¤ï¼šæŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p><p><img src="https://gitee.com/serendipity24/SerendipityPic/raw/master/img/20200803162628.png"></p><p>webè¯·æ±‚ï¼Œé€šè¿‡ä¸€äº›åŒ¹é…æ¡ä»¶ï¼Œå®šä½åˆ°çœŸæ­£çš„æœåŠ¡èŠ‚ç‚¹ã€‚å¹¶åœ¨è¿™ä¸ªè½¬å‘è¿‡ç¨‹çš„å‰åï¼Œè¿›è¡Œä¸€äº›ç²¾ç»†åŒ–æ§åˆ¶ã€‚</p><p>predicateå°±æ˜¯æˆ‘ä»¬çš„åŒ¹é…æ¡ä»¶ï¼›è€Œfilterï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„æ‹¦æˆªå™¨ã€‚è€Œæœ‰äº†è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå†åŠ ä¸Šç›®æ ‡uriï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªå…·ä½“çš„è·¯ç”±äº†ã€‚</p></blockquote><h2 id="Gatewayå·¥ä½œæµç¨‹"><a href="#Gatewayå·¥ä½œæµç¨‹" class="headerlink" title="Gatewayå·¥ä½œæµç¨‹"></a>Gatewayå·¥ä½œæµç¨‹</h2><blockquote><p><img src="https://gitee.com/serendipity24/SerendipityPic/raw/master/img/20200803163117.png"></p><p>æ ¸å¿ƒé€»è¾‘ï¼šè·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾</p></blockquote><h2 id="å…¥é—¨é…ç½®"><a href="#å…¥é—¨é…ç½®" class="headerlink" title="å…¥é—¨é…ç½®"></a>å…¥é—¨é…ç½®</h2><p>1.æ–°å»ºmoduleï¼šcloud-gateway-gateway9527</p><p><img src="https://gitee.com/serendipity24/SerendipityPic/raw/master/img/20200803163739.png"></p><p>2.æ”¹pomæ–‡ä»¶</p><pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud2020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.sunqs.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-gateway-gateway9527<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--gateway--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--eureka client--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--å¼•å…¥è‡ªå®šä¹‰çš„apié€šç”¨åŒ…ï¼Œå¯ä½¿ç”¨Paymentæ”¯ä»˜Entity--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aiguigu.springcloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>cloud-api-commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token comment" spellcheck="true">&lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span></code></pre><p>3.å†™yml</p><pre class=" language-yml"><code class="language-yml">server:  port: 9527spring:  application:    name: cloud-gateway  cloud:    gateway:      routes:        - id: payment_routh #payment_routh    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å          uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€          predicates:            - Path=/payment/get/**          #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±        - id: payment_routh2 #payment_routh   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€          predicates:            - Path=/payment/lb/**             #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±eureka:  instance:    hostname: cloud-gateway-service  client:    service-url:      register-with-eureka: true      fetch-registry: true      defaultZone: http://eureka7001.com:7001/eureka</code></pre><p>4.ä¸šåŠ¡ç±»ï¼šæ— </p><p>5.ä¸»å¯åŠ¨ç±»ï¼šGateWayMain9527</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableEurekaClient</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GateWayMain9527</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>GateWayMain9527<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>6.æµ‹è¯•ï¼š<a href="http://localhost:8001/payment/get/31%E4%B8%8Ehttp://localhost:9527/payment/get/31">http://localhost:8001/payment/get/31ä¸http://localhost:9527/payment/get/31</a></p><p>éƒ½å¯ä»¥è®¿é—®åˆ°ã€‚</p><p><img src="https://gitee.com/serendipity24/SerendipityPic/raw/master/img/20200803171004.png"></p><p><img src="https://gitee.com/serendipity24/SerendipityPic/raw/master/img/20200803171039.png"></p><p>7:gatewayç½‘å…³è·¯ç”±æœ‰ä¸¤ç§é…ç½®æ–¹å¼</p><blockquote><p>åœ¨é…ç½®æ–‡ä»¶ymlä¸­é…ç½®ï¼›</p><p>ä»£ç ä¸­æ³¨å…¥RouteLocatorçš„Beanï¼š</p></blockquote><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayConfig</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> RouteLocator <span class="token function">customRouteLocator</span><span class="token punctuation">(</span>RouteLocatorBuilder routeLocatorBuilder<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        RouteLocatorBuilder<span class="token punctuation">.</span>Builder routes <span class="token operator">=</span> routeLocatorBuilder<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        routes<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"path_route_atguigu"</span><span class="token punctuation">,</span>                r <span class="token operator">-</span><span class="token operator">></span> r<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/guonei"</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"http://news.baidu.com/guonei"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> routes<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><p>å¦‚æœè¦è®¿é—® <a href="http://news.baidu.com/guonei">http://news.baidu.com/guonei</a> è¿™ä¸ªç½‘ç«™,é…ç½®è·¯ç”±è§„åˆ™ä¸º<a href="http://localhost:9527/guonei%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0">http://localhost:9527/guoneiå°±å¯ä»¥è®¿é—®åˆ°</a></p><h2 id="é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±"><a href="#é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±" class="headerlink" title="é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±"></a>é€šè¿‡å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</h2><blockquote><p>pomæ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹</p></blockquote><pre class=" language-yml"><code class="language-yml">server:  port: 9527spring:  application:    name: cloud-gateway  cloud:    gateway:      discovery:        locator:          enabled: true #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½,åˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±      routes:        - id: payment_routh #payment_routh    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å          uri: lb://cloud-payment-service          #          uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€          predicates:            - Path=/payment/get/**          #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±        - id: payment_routh2 #payment_routh   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œç®€æ˜“é…åˆæœåŠ¡å          uri: lb://cloud-payment-service          #          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€          predicates:            - Path=/payment/lb/**             #æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±eureka:  instance:    hostname: cloud-gateway-service  client:    fetch-registry: true    register-with-eureka: true    service-url:      #è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€      #      defaultZone: http://eureka7002.com:7002/eureka/      #      å•æœºç‰ˆeureka      defaultZone: http://eureka7001.com:7001/eureka/</code></pre><h2 id="Predicateçš„ä½¿ç”¨"><a href="#Predicateçš„ä½¿ç”¨" class="headerlink" title="Predicateçš„ä½¿ç”¨"></a>Predicateçš„ä½¿ç”¨</h2><h3 id="å¸¸ç”¨çš„Route-Predicate"><a href="#å¸¸ç”¨çš„Route-Predicate" class="headerlink" title="å¸¸ç”¨çš„Route Predicate"></a>å¸¸ç”¨çš„Route Predicate</h3><blockquote><p>After Route Predicateï¼š- After=2020-08-04T08:54:04.768+08:00[Asia/Shanghai]</p><p>Before Route Predicateï¼š- Before=2020-08-04T08:54:04.768+08:00[Asia/Shanghai]</p><p>Between Route Predicateï¼š- Between=2020-08-04T08:54:04.768+08:00[Asia/Shanghai],2020-09-04T08:54:04.768+08:00[Asia/Shanghai]</p><p>Cookie Route Predicateï¼š- Cookie=username,zzyy</p><p>Header Route Predicateï¼š- Header=X-Request-Id,\d+</p><p>Host Route Predicate</p><p>Method Route Predicate</p><p>Path Route Predicate</p><p>Query Route Predicate</p></blockquote><h4 id="æ—¶é—´æ–­è¨€æ ¼å¼çš„è·å–"><a href="#æ—¶é—´æ–­è¨€æ ¼å¼çš„è·å–" class="headerlink" title="æ—¶é—´æ–­è¨€æ ¼å¼çš„è·å–"></a>æ—¶é—´æ–­è¨€æ ¼å¼çš„è·å–</h4><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    ZonedDateTime zdt <span class="token operator">=</span> ZonedDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zdt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span>04T08<span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">04.768</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">[</span>Asia<span class="token operator">/</span>Shanghai<span class="token punctuation">]</span></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Predicateå°±æ˜¯ä¸ºäº†å®ç°ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œè®©è¯·æ±‚è¿‡æ¥æ‰¾åˆ°å¯¹åº”çš„Routeè¿›è¡Œå¤„ç†ã€‚</p><h2 id="Filterçš„ä½¿ç”¨"><a href="#Filterçš„ä½¿ç”¨" class="headerlink" title="Filterçš„ä½¿ç”¨"></a>Filterçš„ä½¿ç”¨</h2><h3 id="Gateway-Filteræ˜¯ä»€ä¹ˆ"><a href="#Gateway-Filteræ˜¯ä»€ä¹ˆ" class="headerlink" title="Gateway Filteræ˜¯ä»€ä¹ˆ"></a>Gateway Filteræ˜¯ä»€ä¹ˆ</h3><p>è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚</p><p>Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿã€‚</p><p>ç”Ÿå‘½å‘¨æœŸï¼špreï¼Œpost</p><p>ç§ç±»ï¼šGatewayFilter(31ç§),GlobalFilter(åç§)</p><h3 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h3><p>1.åˆ›å»ºGatewayé…ç½®ç±»</p><pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLogGatewayFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span><span class="token punctuation">,</span> Ordered <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> Mono<span class="token operator">&lt;</span>Void<span class="token operator">></span> <span class="token function">filter</span><span class="token punctuation">(</span>ServerWebExchange exchange<span class="token punctuation">,</span> GatewayFilterChain chain<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"******come in MyLogGatewayFilter: "</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String uname <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>uname <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"******ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼ŒğŸ˜¿"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span>HttpStatus<span class="token punctuation">.</span>NOT_ACCEPTABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//    @Override å®ç°ä¸Šé¢@Order(0)æ³¨è§£å°±å¯ä»¥ä¸ç”¨å®ç°æ¥å£</span><span class="token comment" spellcheck="true">//    public int getOrder() &amp;#123;</span><span class="token comment" spellcheck="true">//        return 0;</span><span class="token comment" spellcheck="true">//    &amp;#125;</span></code></pre><p>å¯ä»¥å†™å¤šä¸ªFilterè¿›è¡Œè¿‡æ»¤ï¼Œä¼ å›è¿‡æ»¤é“¾å°±è¡Œã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2020/08/03/hello-world/"/>
      <url>/2020/08/03/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
